<html>

<head>

	<meta charset="utf-8" />

	<title>2016 Lenten Fish Fry Map</title>

	<script src='js/mapbox.js'></script>
	<script src='js/leaflet-omnivore.min.js'></script>
	<link href="css/leaflet.css" rel="stylesheet" type="text/css"/>
	<script src="js/L.Control.Sidebar.js"></script>
	<link href="css/L.Control.Sidebar.css" rel="stylesheet" type="text/css"/>
	<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
	<script src='js/jquery-1.11.0.min.js'></script>
	<link href="css/app.css" rel="stylesheet" type="text/css" />

</head>

<body>

	<div id="sidebar">
		<div>
			<h2><a href="https://www.facebook.com/PittsburghLentenFishFryMap/">2016 Pittsburgh Lenten Fish Fry Map</a></h2>
			<p>Helping you find your local fish fry this Lenten season!</p>
		</div>
		<div>
			<table>
				<tr>
					<th style="width:30%;">
						<nav class='menu-ui'>
							<a href='#' class='active' data-filter='all'>All</a>
							<a href='#' data-filter='lunch'>Open for Lunch</a>
							<a href='#' data-filter='alcohol'>Serves Alcohol</a>
                            <a href='#' data-filter='pierogies'>Serves Homemade Pierogies</a>
						</nav>
					</th>
					<th style="width:70%;">
						<ul id='marker-list'></ul>
					</th>
				</tr>
			</table>
		</div>
		<div>

			<hr>
<!--
			<p>Lent 2016 begins February 10. Show some community love, and enjoy fish sandwiches, pierogies/pirohi, haluski, baked goods, and other Pittsburgh fare.</p>
			<p>The map is a fun project we've been doing--along with help from all of you--since 2012. Listing on the map is free, and the work is all volunteer. We collect fish fry information from all local media outlets as well as individuals who send us information.</p>
			<p>If your fish fry isn't listed, send us time, date, and any menu information, and we'll get it on the map.</p>
		</div>
	</div>
-->


	<!--LEAFLET MAP-->
	<div id="map" class='custom-popup'></div>


	<!-- -----------------------
LEAFLET SCRIPT -------------
------------------------ -->



	<script>
		L.mapbox.accessToken = 'pk.eyJ1IjoiY2JndGhvcjYyNCIsImEiOiJzZ2NaNmo4In0.hbXzZPAvaCO5GLu45bptTw';
		// drawn from https://www.mapbox.com/mapbox.js/example/v1.0.0/markers-with-multiple-filters/

		// initialize the map
		var map = L.map('map').setView([40.4452, -79.9866], 10);
		var markerList = document.getElementById('marker-list');

		// create mapstack tile layer and add to map
		L.tileLayer(
			'http://{s}.sm.mapstack.stamen.com/((toner-lite,$000%5B@80%5D,$8ad3f4%5Bhsl-color%5D,mapbox-water%5Bdestination-in%5D),(toner,$fff%5Bdifference%5D,$fdb930%5Bhsl-color%5D,mapbox-water%5Bdestination-out%5D),(toner-hybrid,$fff%5Bdifference%5D,$fdb930%5Bhsl-color%5D),(terrain-background,$000%5B@40%5D,$ffffff%5Bhsl-color%5D,mapbox-water%5Bdestination-out%5D)%5Blighter@40%5D)/{z}/{x}/{y}.png', {
				attribution: '<pa style="font-size:0.5rem">Library from <a style="color:black" href="http://www.mapbox.com">Mapbox</a> Map tiles by <a style="color:black" href="http://stamen.com">Stamen Design</a>, under <a style="color:black"href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> license. Data by <a style="color:black"href="http://openstreetmap.org">OpenStreetMap</a>, under <a style="color:black"href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a> license.</pa>',
				maxZoom: 18,
				minZoom: 8,
			}
		).addTo(map);

		var customLayer = L.geoJson(null, {
			pointToLayer: function(feature, latlng) {
				var marker = L.marker(latlng, {
					icon: L.mapbox.marker.icon({
						'marker-size': 'small',
						'marker-symbol': 'beer',
						'marker-color': '#fdb930'
					})
				});
				return marker;
			}
		});

		var runLayer = omnivore.kml('geodata.kml', null, customLayer) /*.addTo(map);*/

/*
		  // Filter markers that have 'day1' set to "true", and return true
		  .setFilter(function(f) {
		  		return (f.properties.day1 == "TRUE") ? true : false;
		  	})
		  	//create popup
		  	// create initial list of features (post-filter). This code is repeated with menu-ui onclick

		  	.eachLayer(function(layer) {
		  		layer.bindPopup(
		  			"<h3><a href=" + layer.toGeoJSON().properties.url + "target='_newtab'>" + layer.toGeoJSON().properties.name + "</a></h3>" +
		  			"<p>" + layer.toGeoJSON().properties.type + "</p>" +
		  			"<p><strong>" + layer.toGeoJSON().properties.location + "</strong><br>" + layer.toGeoJSON().properties.address + "</p>" +
		  			"<p>" + layer.toGeoJSON().properties.day + " - " + layer.toGeoJSON().properties.time + "</p>"
		  		)
		  		var item = markerList.appendChild(document.createElement('li'));
		  		item.innerHTML = layer.toGeoJSON().properties.name + " @ " + layer.toGeoJSON().properties.location;
		  		item.onclick = function() {
		  			map.setView(layer.getLatLng(), 12);
		  			layer.openPopup();
		  		};
		  	})
		  	*/
		  	.addTo(map);

		  //console.log(markers._geojson.features[0].properties.name);


		  $('.menu-ui a').on('click', function() {
		    // For each filter link, get the 'data-filter' attribute value.
		    var filter = $(this).data('filter');
		    $(this).addClass('active').siblings().removeClass('active');
		    // Filter markers that have a value set to "true", and return true
		    markers.setFilter(function(f) {
              // If the data-filter attribute is set to "all", return
              // all (true). Otherwise, filter on markers that have
              // a value set to true based on the filter name.
		      return (filter === 'all') ? true : f.properties[filter] === true;
		      });
            return false;
          });
/*
		    //Clear existing list of venues
		    while (markerList.hasChildNodes()) {
		      markerList.removeChild(markerList.firstChild);
		      }
		    // generate new list of venues
		    markers.eachLayer(function(layer) {
		      var item = markerList.appendChild(document.createElement('li'));
		      item.innerHTML = layer.toGeoJSON().properties.name + " @ " + layer.toGeoJSON().properties.location;
		      layer.bindPopup(
		        "<h3><a href="+layer.toGeoJSON().properties.url+"target='_newtab'>"+layer.toGeoJSON().properties.name+"</a></h3>"+
		        "<p>"+layer.toGeoJSON().properties.type+"</p>"+
		        "<p><strong>"+layer.toGeoJSON().properties.location+"</strong><br>"+layer.toGeoJSON().properties.address+"</p>"+
		        "<p>"+layer.toGeoJSON().properties.day+" - "+layer.toGeoJSON().properties.time+"</p>"
		        )
		      item.onclick = function() {
		        map.setView(layer.getLatLng(), 12);
		        layer.openPopup();
		        };
		      });
		    return false;

		    });
		  /*
		  map.on('ready', function(e) {
		    map.eachLayer(function(layer) {
		      var item = markerList.appendChild(document.createElement('li'));
		      //item.innerHTML = markers.getGeoJSON().properties.name;
		      item.innerHTML = layer.toGeoJSON().properties.name;

		      item.onclick = function() {
		        map.setView(layer.getLatLng(), 14);
		        layer.openPopup();
		        };
		      });
		    });
		  */

		// create sidebar and add to map (not required for maptime demonstration)
		var sidebar = L.control.sidebar('sidebar', {
			closeButton: false,
			position: 'left'
		});

		map.addControl(sidebar);

		setTimeout(function() {
			sidebar.show();
		}, 500);
	</script>


</body>

</html>
